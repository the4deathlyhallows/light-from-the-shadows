# hunt_queries.md
Hunting & Detection Queries for Common MITRE ATT&CK Techniques
==============================================================

This file provides example Splunk searches and Sigma rules for several of the most common MITRE ATT&CK techniques.  
All content references MITRE ATT&CK® (© The MITRE Corporation, used under license).

---

## T1059 – Command and Scripting Interpreter (PowerShell)

### Splunk Query
```spl
index=windows EventCode=4104
| search ScriptBlockText="*" 
| eval is_encoded=if(like(ScriptBlockText,"%FromBase64String%") OR like(ScriptBlockText,"%Invoke-Expression%"), "yes","no")
| search is_encoded="yes"
| table _time, host, user, ScriptBlockText
Sigma Rule (YAML)
title: PowerShell EncodedCommand Execution
id: 2f2a2c90-bd7c-4d94-bdc3-ec3a0535d13c
status: experimental
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    CommandLine|contains: "powershell.exe"
    CommandLine|contains: "-EncodedCommand"
  condition: selection
level: high
tags:
  - attack.execution
  - attack.t1059.001
T1078 – Valid Accounts (Credential Misuse)
Splunk Query
index=wineventlog (EventCode=4624 OR EventCode=4625)
| eval logonType=Logon_Type
| search logonType IN (2,10) 
| stats count by Account_Name, src_ip, dest_ip
| where count > 5
Sigma Rule
title: Multiple Failed Logons (Possible Brute Force / Valid Accounts Abuse)
id: 6f82eaf2-d9df-4e4f-9dc5-1c67ec0a993d
status: experimental
logsource:
  category: authentication
  product: windows
detection:
  selection:
    EventID: 4625
  condition: selection
level: medium
tags:
  - attack.persistence
  - attack.t1078
T1003 – OS Credential Dumping (LSASS)
Splunk Query
index=wineventlog EventCode=4688
| search New_Process_Name="*\\procdump.exe" OR New_Process_Name="*\\lsass.exe"
| table _time, host, user, New_Process_Name, Command_Line
Sigma Rule
title: Potential LSASS Memory Dump via Procdump
id: 9a57a3df-c4f3-47b8-86d2-2ddf26b2e874
status: experimental
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    CommandLine|contains:
      - "procdump"
      - "lsass.exe"
  condition: selection
level: high
tags:
  - attack.credential_access
  - attack.t1003.001
T1053 – Scheduled Task / Job
Splunk Query
index=wineventlog EventCode=4698
| eval suspicious=if(like(Task_Name,"%update%") OR like(Task_Name,"%patch%"), "yes","no")
| search suspicious="yes"
| table _time, host, user, Task_Name, Command_Line
Sigma Rule
title: Suspicious Scheduled Task Creation
id: 62ab07a7-1cd7-4c54-9c7e-8cf2442e2172
status: experimental
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    EventID: 4698
  condition: selection
level: medium
tags:
  - attack.persistence
  - attack.t1053
T1486 – Data Encrypted for Impact (Ransomware)
Splunk Query
index=filesystem sourcetype="fs_change"
| stats count by file_extension, host
| where file_extension IN ("locky","crypt","ryuk","conti","encrypted")
| table _time, host, file_path, file_extension
Sigma Rule
title: Suspicious File Extensions - Possible Ransomware
id: d19b94ef-733a-40ad-8a1a-25ad2d8e514e
status: experimental
logsource:
  category: file_event
detection:
  selection:
    TargetFilename|endswith:
      - ".locked"
      - ".crypt"
      - ".ryuk"
      - ".conti"
      - ".encrypted"
  condition: selection
level: critical
tags:
  - attack.impact
  - attack.t1486
T1562 – Impair Defenses (Disable Security Tools)
Splunk Query
index=wineventlog EventCode=4688
| search (Command_Line="*net stop*" OR Command_Line="*sc stop*" OR Command_Line="*taskkill*")
| table _time, host, user, New_Process_Name, Command_Line
Sigma Rule
title: Stop Security Services
id: b4b7e218-d1a4-4f3a-927d-0a688b4af011
status: experimental
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    CommandLine|contains:
      - "net stop"
      - "sc stop"
      - "taskkill"
  condition: selection
level: high
tags:
  - attack.defense_evasion
  - attack.t1562.001
